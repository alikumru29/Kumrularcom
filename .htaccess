# Enable rewrite engine
RewriteEngine On

# Handle API requests
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^api/(.*)$ http://localhost:4000/api/$1 [P,L]

# Set proper headers for API responses
<LocationMatch "^/api/">
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
</LocationMatch>

# Handle Node.js application
PassengerEnabled on
PassengerAppType node
PassengerStartupFile dist/server/index.js
PassengerAppEnv production