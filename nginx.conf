passenger_enabled on;
passenger_app_type node;
passenger_startup_file dist/server/index.js;
passenger_app_env production;

root /var/www/vhosts/kumrular.com/httpdocs/dist/client;

# Handle static files
location /assets {
    alias /var/www/vhosts/kumrular.com/httpdocs/dist/client/assets;
    expires 1y;
    add_header Cache-Control "public, no-transform";
}

# Handle API requests
location /api {
    passenger_enabled on;
    passenger_app_type node;
    passenger_startup_file dist/server/index.js;
}

# Handle all other requests - SPA routing
location / {
    passenger_enabled on;
    passenger_app_type node;
    passenger_startup_file dist/server/index.js;
    passenger_env_var PORT 4000;
    passenger_env_var NODE_ENV production;
}

# Set proper MIME types
types {
    application/javascript  js mjs;
    text/css               css;
    text/html              html htm;
}